<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DAPFLIX</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <h1>DAPFLIX</h1>
</header>

<main>
    <div class="tab-container">
        <div class="tab active" data-tab="cine">Cine</div>
        <div class="tab" data-tab="streaming">Streaming</div>
    </div>

    <div class="loading-indicator" id="loadingIndicator">
        Cargando... <div class="spinner"></div>
    </div>

    <div id="cine" class="panel active">
        <div class="kpi-container">
            <div class="kpi">
                <h2 id="peliculas-en-cartelera">0</h2>
                <p>Películas en cartelera</p>
            </div>
            <div id="mas-vista"class="kpi">
                <h2></h2>
                <p>Más vista esta semana</p>
            </div>
            <div id="mas-vista-esp"class="kpi">
                <h2 id="titulo-pelicula"></h2>
                <p>Española más vista</p>
            </div>
        </div>

        <div class="chart-grid">
            <div class="chart" id="barChartContainer">
                <h3>Películas por cine</h3>
                <canvas id="comparativaChart"></canvas>
            </div>
            <div class="chart" id="pieChartContainer">
                <h3>Recaudación 2025</h3>
                <canvas id="historicalPieChart"></canvas>
            </div>
            <div class="ranking-table">
                <h3>Ranking de Películas 2025</h3>
                <table>
                    <thead>
                    <tr>
                        <th>Posición</th>
                        <th>Película</th>
                        <th>Recaudación</th>
                    </tr>
                    </thead>
                    <tbody id="rankingTableBody">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Botón único para cargar las películas -->
        <div>
            <button id="loadMoviesBtn">Cargar Películas</button>
        </div>

        <!-- Indicador de carga -->
        <div class="movies-section" id="cineMovies">
            <!-- Las películas se cargarán aquí -->
        </div>
    </div>

    <div id="streaming" class="panel">
        <div class="kpi-container">
            <div class="chart" id="platformsChartTvContainer">
                <h3>Series en plataformas de Streaming</h3>
                <canvas id="platformsChartTv"></canvas>
            </div>

            <script>
                // Esperar a que el DOM esté completamente cargado antes de ejecutar el script
                document.addEventListener("DOMContentLoaded", () => {
                    const ctxTv = document.getElementById('platformsChartTv').getContext('2d');

                    // Obtener los datos de las series desde los endpoints
                    Promise.all([
                        fetch('http://localhost:8080/api/movies/count/netflixtv').then(res => res.json()),
                        fetch('http://localhost:8080/api/movies/count/disneytv').then(res => res.json()),
                        fetch('http://localhost:8080/api/movies/count/maxtv').then(res => res.json())
                    ]).then(([netflixTv, disneyTv, maxTv]) => {
                        // Crear el gráfico de series
                        new Chart(ctxTv, {
                            type: 'bar', // Tipo de gráfico
                            data: {
                                labels: ['Netflix TV', 'Disney+ TV', 'Max TV'], // Etiquetas para cada plataforma
                                datasets: [{
                                    label: 'Número de Series',
                                    data: [netflixTv, disneyTv, maxTv], // Datos de las series
                                    backgroundColor: [
                                        'rgba(255, 99, 132, 0.2)', // Color para Netflix
                                        'rgba(54, 162, 235, 0.2)', // Color para Disney+
                                        'rgba(75, 192, 192, 0.2)'  // Color para Max
                                    ],
                                    borderColor: [
                                        'rgba(255, 99, 132, 1)',
                                        'rgba(54, 162, 235, 1)',
                                        'rgba(75, 192, 192, 1)'
                                    ],
                                    borderWidth: 1 // Grosor del borde de las barras
                                }]
                            },
                            options: {
                                responsive: true,
                                plugins: {
                                    legend: {
                                        display: true,
                                        position: 'top',
                                    }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true // Iniciar el eje Y en cero
                                    }
                                }
                            }
                        });
                    }).catch(err => {
                        console.error("Error al obtener datos para la gráfica de TV:", err);
                    });
                });
            </script>
            <div class="chart" id="platformsChartContainer">
                <h3>Plataformas de Streaming</h3>
                <canvas id="platformsChart"></canvas>
            </div>
        </div>

        <div id="streamingButtons">
            <button id="netflixBtn">Ver Películas de Netflix</button>
            <button id="disneyPlusBtn">Ver Películas de Disney+</button>
            <button id="maxBtn">Ver Películas de Max</button>
        </div>

        <div class="movies-section" id="streamingMovies">
            <!-- Las películas se cargarán aquí -->
        </div>
    </div>

    <div id="comparativa" class="panel">
        <!-- Panel Comparativa sin cambios -->
    </div>
</main>

<footer>
    Datos actualizados el: <span id="currentDate"></span>
</footer>
<script>
    // Obtener la fecha actual
    const today = new Date();
    const options = { year: 'numeric', month: 'long', day: 'numeric' };
    const formattedDate = today.toLocaleDateString('es-ES', options);

    // Insertar la fecha en el elemento con id "currentDate"
    document.getElementById('currentDate').textContent = formattedDate;
</script>

<script src="script.js"></script>
</body>
</html>